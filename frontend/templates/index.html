<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LEMON Orchestrator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>
    <div class="backdrop"></div>
    <main class="shell">
      <header class="hero">
        <div class="hero-text">
          <p class="eyebrow">LEMON ORCHESTRATOR</p>
          <h1>Turn a workflow image into tested Python code.</h1>
          <p class="lead">
            Upload a diagram, approve the extracted logic, watch the pipeline run in the open,
            then download the generated file.
          </p>
        </div>
        <div class="hero-swatch">
          <div class="swatch"></div>
          <div class="swatch"></div>
          <div class="swatch"></div>
        </div>
      </header>

      <section class="studio" id="studio">
        <div class="studio-header">
          <div>
            <p class="eyebrow">FLOWCHART STUDIO</p>
            <h2>Build the workflow in the canvas.</h2>
            <p class="lead muted">
              Drag shapes, connect decisions, or describe the flowchart in plain language.
            </p>
          </div>
          <div class="studio-actions">
            <label class="field">
              <span>Workflow name</span>
              <input id="workflowName" type="text" placeholder="e.g. lipid_risk_v2" />
            </label>
            <div class="history-controls">
              <button class="ghost" id="historyBack">Back</button>
              <button class="ghost" id="historyForward">Forward</button>
              <button class="ghost" id="snapshotFlowchart">Snapshot</button>
            </div>
            <div class="upload-row">
              <input id="fileInput" type="file" accept="image/*" />
              <button class="ghost" id="uploadButton">Upload image</button>
              <span class="hint" id="uploadHint">PNG/JPG for analysis</span>
            </div>
            <button class="primary" id="runPipeline">Run pipeline</button>
            <button class="ghost" id="clearState">Clear state</button>
          </div>
        </div>
        <div class="studio-grid">
          <aside class="palette">
            <p class="eyebrow">SHAPES</p>
            <div class="palette-grid">
              <button class="palette-item" data-type="start">Start</button>
              <button class="palette-item" data-type="process">Process</button>
              <button class="palette-item" data-type="decision">Decision</button>
              <button class="palette-item" data-type="subprocess">Sub-process</button>
              <button class="palette-item" data-type="end">End</button>
            </div>
            <p class="eyebrow">COLORS</p>
            <div class="color-row" id="paletteColors">
              <button class="color-chip is-active" data-color="teal"></button>
              <button class="color-chip" data-color="amber"></button>
              <button class="color-chip" data-color="green"></button>
              <button class="color-chip" data-color="slate"></button>
              <button class="color-chip" data-color="rose"></button>
              <button class="color-chip" data-color="sky"></button>
            </div>
            <div class="palette-actions">
              <button class="ghost" id="autoLayout">Auto layout</button>
              <button class="ghost" id="connectToggle">Connect</button>
              <button class="ghost" id="clearCanvas">Clear</button>
              <button class="ghost" id="exportPreview">Preview image</button>
            </div>
            <div class="connect-status" id="connectStatus">Connect: off</div>
            <div class="inspector" id="nodeInspector">
              <div class="inspector-header">
                <h4>Selected node</h4>
                <span class="muted" id="selectedNodeHint">None</span>
              </div>
              <label class="field">
                <span>Label</span>
                <input id="nodeLabelInput" type="text" placeholder="Select a node" />
              </label>
              <label class="field">
                <span>Type</span>
                <select id="nodeTypeSelect">
                  <option value="start">Start</option>
                  <option value="process">Process</option>
                  <option value="decision">Decision</option>
                  <option value="subprocess">Sub-process</option>
                  <option value="end">End</option>
                </select>
              </label>
              <div class="field">
                <span>Color</span>
                <div class="color-row" id="nodeColorRow">
                  <button class="color-chip" data-color="teal"></button>
                  <button class="color-chip" data-color="amber"></button>
                  <button class="color-chip" data-color="green"></button>
                  <button class="color-chip" data-color="slate"></button>
                  <button class="color-chip" data-color="rose"></button>
                  <button class="color-chip" data-color="sky"></button>
                </div>
              </div>
              <button class="ghost" id="deleteNode">Delete node</button>
            </div>
          </aside>
          <div class="canvas-panel">
            <div class="canvas-wrap">
              <svg id="flowchartCanvas" viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid meet">
                <defs>
                  <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#2b2d2a"></polygon>
                  </marker>
                </defs>
                <g id="edgeLayer"></g>
                <g id="nodeLayer"></g>
              </svg>
            </div>
            <div class="upload-preview" id="uploadPreview">
              <p class="muted">No image uploaded yet.</p>
            </div>
          </div>
        </div>
      </section>

      <section class="timeline" id="timeline">
        <div class="thread" id="thread"></div>

        <div class="stage thinking-card" id="thinkingCard">
          <div class="thinking-wheel"></div>
          <div class="thinking-main">
            <div>
              <h3>Orchestrator thinking</h3>
              <p class="muted">Analyzing the workflow structure and parsing inputs.</p>
            </div>
          </div>
        </div>

        <div class="analysis-stack" id="analysisStack"></div>

        <div class="stage tests-card" id="testsCard">
          <div class="stage-header">
            <div>
              <p class="eyebrow">TEST CASES</p>
              <h3>Generating and labeling</h3>
            </div>
            <div class="badge" id="testsPercent">0%</div>
          </div>
          <div class="progress">
            <div class="progress-bar" id="testsBar"></div>
          </div>
          <p class="muted" id="testsDetail">Waiting to start.</p>
        </div>

        <div class="stage iteration-card" id="iterationsCard">
          <div class="stage-header">
            <div>
              <p class="eyebrow">REFINEMENT LOOP</p>
              <h3>Iteration scores</h3>
            </div>
          </div>
          <div class="iterations" id="iterationsList"></div>
        </div>

        <div class="stage download-card" id="downloadCard">
          <div>
            <h3>Python file ready</h3>
            <p class="muted">Download the generated implementation.</p>
          </div>
          <a class="primary" id="downloadButton" href="#">Download workflow.py</a>
        </div>

      </section>
    </main>

    <div class="chat-dock">
      <div class="chat-dock-inner">
        <textarea id="chatInput" placeholder="Message the orchestrator..."></textarea>
        <button class="primary" id="sendChat">Send</button>
      </div>
    </div>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
  </body>
</html>
