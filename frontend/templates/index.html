<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>LEMON Orchestrator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>
    <div class="backdrop"></div>
    <main class="shell">
      <header class="hero">
        <div class="hero-text">
          <p class="eyebrow">LEMON ORCHESTRATOR</p>
          <h1>Turn a workflow image into tested Python code.</h1>
          <p class="lead">
            Upload a diagram, approve the extracted logic, watch the pipeline run in the open,
            then download the generated file.
          </p>
        </div>
        <div class="hero-swatch">
          <div class="swatch"></div>
          <div class="swatch"></div>
          <div class="swatch"></div>
        </div>
      </header>

      <section class="upload-panel" id="uploadPanel">
        <div class="upload-grid" id="uploadGrid">
          <div class="upload-slot" data-slot="0"></div>
          <div class="upload-slot" data-slot="1"></div>
          <div class="upload-slot" data-slot="2"></div>
          <div class="upload-slot" data-slot="3"></div>
          <div class="upload-slot" data-slot="4"></div>
          <div class="upload-slot" data-slot="5"></div>
        </div>
        <div class="upload-card">
          <div class="upload-copy">
            <h2>Drop a workflow image</h2>
            <p>We accept PNG, JPG, or PDF diagrams. One file at a time.</p>
          </div>
          <div class="upload-action">
            <label class="field">
              <span>Workflow name</span>
              <input id="workflowName" type="text" placeholder="e.g. lipid_risk_v2" />
            </label>
            <input id="fileInput" type="file" accept="image/*" />
            <button class="primary" id="uploadButton">Choose file</button>
            <p class="hint" id="uploadHint">Drag and drop to begin.</p>
          </div>
        </div>
        <div class="upload-preview" id="uploadPreview">
          <p class="muted">No image loaded yet.</p>
        </div>
      </section>

      <section class="timeline" id="timeline">
        <div class="thread" id="thread"></div>

        <div class="stage thinking-card" id="thinkingCard">
          <div class="thinking-wheel"></div>
          <div class="thinking-main">
            <div>
              <h3>Orchestrator thinking</h3>
              <p class="muted">Analyzing the workflow structure and parsing inputs.</p>
            </div>
          </div>
        </div>

        <div class="stage analysis-card" id="analysisCard">
          <div class="stage-header">
            <div>
              <p class="eyebrow">ANALYSIS REVIEW</p>
              <h3>Inputs and outputs</h3>
            </div>
            <div class="badge" id="analysisRevision">Revision 0</div>
          </div>
          <div class="analysis-body">
            <div>
              <h4>Inputs</h4>
              <div class="inputs" id="inputsList"></div>
            </div>
            <div>
              <h4>Outputs</h4>
              <div class="outputs" id="outputsList"></div>
            </div>
          </div>
          <div class="analysis-actions">
            <button class="primary" id="approveButton">Approve</button>
            <button class="ghost" id="feedbackToggle">Needs refinement</button>
          </div>
          <div class="feedback" id="feedbackPanel">
            <p class="muted">Tell the orchestrator what feels wrong. It will re-run the analysis.</p>
            <div class="chips" id="feedbackChips">
              <button class="chip" data-chip="Ranges are wrong">Ranges are wrong</button>
              <button class="chip" data-chip="Missing input">Missing input</button>
              <button class="chip" data-chip="Outputs are mislabeled">Outputs are mislabeled</button>
              <button class="chip" data-chip="Decision logic seems off">Decision logic seems off</button>
            </div>
            <textarea id="feedbackInput" placeholder="Describe the issue..."></textarea>
            <div class="actions-row">
              <button class="primary" id="sendFeedback">Send feedback</button>
              <button class="ghost" id="cancelFeedback">Cancel</button>
            </div>
          </div>
        </div>

        <div class="stage tests-card" id="testsCard">
          <div class="stage-header">
            <div>
              <p class="eyebrow">TEST CASES</p>
              <h3>Generating and labeling</h3>
            </div>
            <div class="badge" id="testsPercent">0%</div>
          </div>
          <div class="progress">
            <div class="progress-bar" id="testsBar"></div>
          </div>
          <p class="muted" id="testsDetail">Waiting to start.</p>
        </div>

        <div class="stage iteration-card" id="iterationsCard">
          <div class="stage-header">
            <div>
              <p class="eyebrow">REFINEMENT LOOP</p>
              <h3>Iteration scores</h3>
            </div>
          </div>
          <div class="iterations" id="iterationsList"></div>
        </div>

        <div class="stage download-card" id="downloadCard">
          <div>
            <h3>Python file ready</h3>
            <p class="muted">Download the generated implementation.</p>
          </div>
          <a class="primary" id="downloadButton" href="#">Download workflow.py</a>
        </div>

        <div class="stage edge-card" id="edgeCard">
          <div>
            <p class="eyebrow">EDGE CASES</p>
            <h3>Challenge the orchestrator</h3>
            <p class="muted">Describe a tricky case in plain language. The orchestrator will validate it.</p>
          </div>
          <div class="edge-input">
            <textarea id="edgeInput" placeholder="Example: 62 year old patient, LDL 190, no diabetes, non-smoker..."></textarea>
            <button class="primary" id="sendEdgeCase">Send edge case</button>
          </div>
        </div>
      </section>
    </main>

    <script src="{{ url_for('static', filename='app.js') }}"></script>
  </body>
</html>
