{
  "inputs": [],
  "outputs": [
    {
      "name": "Mark as Normal / Satisfactory",
      "description": "Tests have normalised or notably improved; mark as normal/satisfactory"
    },
    {
      "name": "Code as normal USS and file",
      "description": "Findings present for <3 months and ALT normal; code as normal USS and file"
    },
    {
      "name": "Requires MRCP via Gastroenterology",
      "description": "Ulcerative Colitis or P-ANCA positive; requires MRCP via Gastroenterology"
    },
    {
      "name": "manage risk factors and co-morbidities - Annual Screening",
      "description": "NAFLD score F0-F2 (no to moderate fibrosis); manage risk factors and annual screening"
    },
    {
      "name": "Fibrous Scan if available",
      "description": "Intermediate or High Risk on FIB4; Fibrous Scan if available"
    },
    {
      "name": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
      "description": "F3-F4 severe fibrosis or cirrhosis; refer to secondary care"
    },
    {
      "name": "No Concern, or escalation required",
      "description": "No referral required; no concern or escalation required"
    },
    {
      "name": "Patient needs consultation for liver pathology and consent for further testing",
      "description": "Sustained or worsening abnormalities confirmed; patient needs consultation for liver pathology"
    }
  ],
  "tree": {
    "start": {
      "id": "start",
      "type": "start",
      "label": "Liver Pathology Suspected & Work up Initiated",
      "children": [
        {
          "id": "n1",
          "type": "action",
          "label": "Baseline & Phase 2 Bloods: LFT, FBC, AST, GGT (to allow FIB4 Calculation)",
          "input_ids": [
            "input_baseline_phase2_bloods_enum"
          ],
          "edge_label": "",
          "children": [
            {
              "id": "n2",
              "type": "decision",
              "label": "Tests normalise or notably improve?",
              "input_ids": [
                "input_baseline_phase2_bloods_enum"
              ],
              "condition": {
                "input_id": "input_baseline_phase2_bloods_enum",
                "comparator": "enum_eq",
                "value": "normalise_or_improve"
              },
              "children": [
                {
                  "id": "n3",
                  "type": "output",
                  "label": "Mark as Normal / Satisfactory",
                  "edge_label": "true",
                  "children": []
                },
                {
                  "id": "n4",
                  "type": "decision",
                  "label": "ALT remains abnormal, worsens and/or additional tests are abnormal too?",
                  "input_ids": [
                    "input_alt_status_enum"
                  ],
                  "condition": {
                    "input_id": "input_alt_status_enum",
                    "comparator": "enum_eq",
                    "value": "abnormal"
                  },
                  "edge_label": "false",
                  "children": [
                    {
                      "id": "n5",
                      "type": "decision",
                      "label": "Findings present for how long?",
                      "input_ids": [
                        "input_findings_duration_enum"
                      ],
                      "condition": {
                        "input_id": "input_findings_duration_enum",
                        "comparator": "enum_eq",
                        "value": "less_than_3_months"
                      },
                      "children": [
                        {
                          "id": "n6",
                          "type": "action",
                          "label": "Recheck Baseline Liver Profile in appropriate timeframe",
                          "input_ids": [
                            "input_recheck_result_enum"
                          ],
                          "edge_label": "false",
                          "children": [
                            {
                              "id": "n7",
                              "type": "decision",
                              "label": "Sustained or worsening abnormalities?",
                              "input_ids": [
                                "input_recheck_result_enum"
                              ],
                              "condition": {
                                "input_id": "input_recheck_result_enum",
                                "comparator": "enum_eq",
                                "value": "sustained_or_worsening"
                              },
                              "children": [
                                {
                                  "id": "n8",
                                  "type": "output",
                                  "label": "Patient needs consultation for liver pathology and consent for further testing",
                                  "edge_label": "true",
                                  "children": []
                                },
                                {
                                  "id": "n9",
                                  "type": "action",
                                  "label": "FIB 4 Score & NAFLD Fibrosis Score",
                                  "input_ids": [
                                    "input_fib4_score_float",
                                    "input_nafld_fibrosis_score_float"
                                  ],
                                  "edge_label": "false",
                                  "children": [
                                    {
                                      "id": "n10",
                                      "type": "decision",
                                      "label": "Liver USS done since abnormal LFT noted?",
                                      "input_ids": [
                                        "input_liver_uss_done_bool"
                                      ],
                                      "condition": {
                                        "input_id": "input_liver_uss_done_bool",
                                        "comparator": "is_false"
                                      },
                                      "children": [
                                        {
                                          "id": "n11",
                                          "type": "action",
                                          "label": "Request Liver USS if not done since abnormal LFT have been noted",
                                          "edge_label": "true",
                                          "children": [
                                            {
                                              "id": "n12",
                                              "type": "action",
                                              "label": "Phase 4 Bloods",
                                              "input_ids": [
                                                "input_fib4_category_enum",
                                                "input_nafld_category_enum"
                                              ],
                                              "edge_label": "",
                                              "children": [
                                                {
                                                  "id": "n13",
                                                  "type": "action",
                                                  "label": "Mandatory Testing",
                                                  "edge_label": "",
                                                  "children": [
                                                    {
                                                      "id": "n14",
                                                      "type": "action",
                                                      "label": "Wilsons Disease Screen: Ceruloplasmin, Alpha 1 Antitrypsin (A1AT) Screen, A1AT",
                                                      "edge_label": "",
                                                      "children": [
                                                        {
                                                          "id": "n_review1",
                                                          "type": "action",
                                                          "label": "Review Result",
                                                          "input_ids": [
                                                            "input_review_result_enum"
                                                          ],
                                                          "edge_label": "",
                                                          "children": [
                                                            {
                                                              "id": "n_review_dec",
                                                              "type": "decision",
                                                              "label": "Review Result abnormal?",
                                                              "input_ids": [
                                                                "input_review_result_enum"
                                                              ],
                                                              "condition": {
                                                                "input_id": "input_review_result_enum",
                                                                "comparator": "enum_eq",
                                                                "value": "abnormal"
                                                              },
                                                              "children": [
                                                                {
                                                                  "id": "n_tel",
                                                                  "type": "action",
                                                                  "label": "Telephone Consultation",
                                                                  "edge_label": "true",
                                                                  "children": [
                                                                    {
                                                                      "id": "n_referral_dec",
                                                                      "type": "decision",
                                                                      "label": "Referral required to secondary care?",
                                                                      "input_ids": [
                                                                        "input_referral_required_bool"
                                                                      ],
                                                                      "condition": {
                                                                        "input_id": "input_referral_required_bool",
                                                                        "comparator": "is_true"
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "id": "n_refer_sec",
                                                                          "type": "output",
                                                                          "label": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
                                                                          "edge_label": "true",
                                                                          "children": []
                                                                        },
                                                                        {
                                                                          "id": "n_no_concern",
                                                                          "type": "output",
                                                                          "label": "No Concern, or escalation required",
                                                                          "edge_label": "false",
                                                                          "children": []
                                                                        }
                                                                      ]
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "id": "n_no_concern2",
                                                                  "type": "output",
                                                                  "label": "No Concern, or escalation required",
                                                                  "edge_label": "false",
                                                                  "children": []
                                                                }
                                                              ]
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                },
                                                {
                                                  "id": "n15",
                                                  "type": "decision",
                                                  "label": "Transferrin Sat >=45% or Raised Ferritin?",
                                                  "input_ids": [
                                                    "input_transferrin_sat_bool"
                                                  ],
                                                  "condition": {
                                                    "input_id": "input_transferrin_sat_bool",
                                                    "comparator": "is_true"
                                                  },
                                                  "edge_label": "",
                                                  "children": [
                                                    {
                                                      "id": "n16",
                                                      "type": "action",
                                                      "label": "Haemachromatosis Gene Test",
                                                      "edge_label": "true",
                                                      "children": [
                                                        {
                                                          "id": "n_raised_igm_dec",
                                                          "type": "decision",
                                                          "label": "Raised IgM?",
                                                          "input_ids": [
                                                            "input_raised_igm_bool"
                                                          ],
                                                          "condition": {
                                                            "input_id": "input_raised_igm_bool",
                                                            "comparator": "is_true"
                                                          },
                                                          "children": [
                                                            {
                                                              "id": "n_pbc",
                                                              "type": "action",
                                                              "label": "Primary Biliary Cirrhosis Screen: AMA",
                                                              "edge_label": "true",
                                                              "children": [
                                                                {
                                                                  "id": "n_raised_igg_dec",
                                                                  "type": "decision",
                                                                  "label": "Raised IgG?",
                                                                  "input_ids": [
                                                                    "input_raised_igg_bool"
                                                                  ],
                                                                  "condition": {
                                                                    "input_id": "input_raised_igg_bool",
                                                                    "comparator": "is_true"
                                                                  },
                                                                  "children": [
                                                                    {
                                                                      "id": "n_aih",
                                                                      "type": "action",
                                                                      "label": "Autoimmune Hepatitis Type 1 Screen: ANA, SMA / Autoimmune Hepatitis Type 2 Screen: LKM-1, SLA (not on EMIS)",
                                                                      "edge_label": "true",
                                                                      "children": [
                                                                        {
                                                                          "id": "n_review2",
                                                                          "type": "action",
                                                                          "label": "Review Result",
                                                                          "input_ids": [
                                                                            "input_review_result_enum"
                                                                          ],
                                                                          "edge_label": "",
                                                                          "children": []
                                                                        }
                                                                      ]
                                                                    },
                                                                    {
                                                                      "id": "n_review3",
                                                                      "type": "action",
                                                                      "label": "Review Result",
                                                                      "input_ids": [
                                                                        "input_review_result_enum"
                                                                      ],
                                                                      "edge_label": "false",
                                                                      "children": []
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            },
                                                            {
                                                              "id": "n_review4",
                                                              "type": "action",
                                                              "label": "Review Result",
                                                              "input_ids": [
                                                                "input_review_result_enum"
                                                              ],
                                                              "edge_label": "false",
                                                              "children": []
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "id": "n_cond_test",
                                                      "type": "action",
                                                      "label": "Conditional Testing",
                                                      "edge_label": "false",
                                                      "children": [
                                                        {
                                                          "id": "n_panca_dec",
                                                          "type": "decision",
                                                          "label": "Ulcerative Colitis or P-ANCA positive?",
                                                          "input_ids": [
                                                            "input_ulcerative_colitis_or_panca_bool"
                                                          ],
                                                          "condition": {
                                                            "input_id": "input_ulcerative_colitis_or_panca_bool",
                                                            "comparator": "is_true"
                                                          },
                                                          "children": [
                                                            {
                                                              "id": "n_mrcp",
                                                              "type": "output",
                                                              "label": "Requires MRCP via Gastroenterology",
                                                              "edge_label": "true",
                                                              "children": []
                                                            },
                                                            {
                                                              "id": "n_nafld_dec",
                                                              "type": "decision",
                                                              "label": "NAFLD Fibrosis Score Category",
                                                              "input_ids": [
                                                                "input_nafld_category_enum"
                                                              ],
                                                              "condition": {
                                                                "input_id": "input_nafld_category_enum",
                                                                "comparator": "enum_eq",
                                                                "value": "F0_F2"
                                                              },
                                                              "edge_label": "false",
                                                              "children": [
                                                                {
                                                                  "id": "n_annual",
                                                                  "type": "output",
                                                                  "label": "manage risk factors and co-morbidities - Annual Screening",
                                                                  "edge_label": "true",
                                                                  "children": []
                                                                },
                                                                {
                                                                  "id": "n_indet_dec",
                                                                  "type": "decision",
                                                                  "label": "NAFLD Score Indeterminate?",
                                                                  "input_ids": [
                                                                    "input_nafld_category_enum"
                                                                  ],
                                                                  "condition": {
                                                                    "input_id": "input_nafld_category_enum",
                                                                    "comparator": "enum_eq",
                                                                    "value": "Indeterminate"
                                                                  },
                                                                  "edge_label": "false",
                                                                  "children": [
                                                                    {
                                                                      "id": "n_fib4_dec",
                                                                      "type": "decision",
                                                                      "label": "FIB4 Categories",
                                                                      "input_ids": [
                                                                        "input_fib4_category_enum"
                                                                      ],
                                                                      "condition": {
                                                                        "input_id": "input_fib4_category_enum",
                                                                        "comparator": "enum_eq",
                                                                        "value": "Low_Risk"
                                                                      },
                                                                      "edge_label": "true",
                                                                      "children": [
                                                                        {
                                                                          "id": "n_low_risk",
                                                                          "type": "action",
                                                                          "label": "Low Risk",
                                                                          "edge_label": "true",
                                                                          "children": [
                                                                            {
                                                                              "id": "n_annual2",
                                                                              "type": "output",
                                                                              "label": "manage risk factors and co-morbidities - Annual Screening",
                                                                              "edge_label": "",
                                                                              "children": []
                                                                            }
                                                                          ]
                                                                        },
                                                                        {
                                                                          "id": "n_int_high",
                                                                          "type": "action",
                                                                          "label": "Intermediate or High Risk",
                                                                          "edge_label": "false",
                                                                          "children": [
                                                                            {
                                                                              "id": "n_fibrous",
                                                                              "type": "output",
                                                                              "label": "Fibrous Scan if available",
                                                                              "edge_label": "",
                                                                              "children": []
                                                                            }
                                                                          ]
                                                                        }
                                                                      ]
                                                                    },
                                                                    {
                                                                      "id": "n_f3f4",
                                                                      "type": "action",
                                                                      "label": "F3-F4 (Severe fibrosis or Cirrhosis)",
                                                                      "edge_label": "false",
                                                                      "children": [
                                                                        {
                                                                          "id": "n_phase4b",
                                                                          "type": "action",
                                                                          "label": "Phase 4 Bloods",
                                                                          "edge_label": "",
                                                                          "children": [
                                                                            {
                                                                              "id": "n_refer2",
                                                                              "type": "output",
                                                                              "label": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
                                                                              "edge_label": "",
                                                                              "children": []
                                                                            }
                                                                          ]
                                                                        }
                                                                      ]
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        {
                                          "id": "n17",
                                          "type": "action",
                                          "label": "Phase 4 Bloods",
                                          "input_ids": [
                                            "input_fib4_category_enum",
                                            "input_nafld_category_enum"
                                          ],
                                          "edge_label": "false",
                                          "children": []
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        },
                        {
                          "id": "n18",
                          "type": "output",
                          "label": "Code as normal USS and file",
                          "edge_label": "true",
                          "children": []
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  },
  "doubts": [
    "The diagram shows multiple feedback loops (e.g., Review Result feeding back into Telephone Consultation, and Phase 4 Bloods appearing multiple times). These cycles cannot be perfectly represented in a strict tree structure; some nodes have been duplicated to approximate the flow.",
    "The 'Need to rationalise which Additional tests should be done for rare conditions' box role in the flow is ambiguous - it appears as an annotation/guidance rather than a clear executable node.",
    "FIB4 score thresholds shown in diagram (<1.3 or <2.0 if age>65 for Low Risk; >1.3 and >2.67 for High Risk) and NAFLD score thresholds (-1.455 to 0.675 for Indeterminate, <-1.455 for F0-F2, >0.675 for F3-F4) are visible but the exact branching logic based on age >65 makes the FIB4 decision more complex than a simple binary split.",
    "The 'Review Result' node appears multiple times in the diagram collecting results from multiple test branches before feeding into Telephone Consultation; the exact merge logic is unclear.",
    "Phase 4 Bloods appears as both a starting point for conditional/mandatory testing and as a downstream node after F3-F4 determination - the intended flow is ambiguous.",
    "The flow from 'Mandatory Testing' through Wilson's Disease Screen, Haemachromatosis Gene Test, Primary Biliary Cirrhosis Screen, and Autoimmune Hepatitis screens appears to be conditional/parallel testing rather than strictly sequential, making tree representation approximate."
  ],
  "variables": [
    {
      "id": "input_baseline_phase2_bloods_enum",
      "name": "baseline_phase2_bloods",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_alt_status_enum",
      "name": "alt_status",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_findings_duration_enum",
      "name": "findings_duration",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_recheck_result_enum",
      "name": "recheck_result",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_fib4_score_float",
      "name": "fib4_score",
      "type": "float",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_nafld_fibrosis_score_float",
      "name": "nafld_fibrosis_score",
      "type": "float",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_liver_uss_done_bool",
      "name": "liver_uss_done",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_fib4_category_enum",
      "name": "fib4_category",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_nafld_category_enum",
      "name": "nafld_category",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_review_result_enum",
      "name": "review_result",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_referral_required_bool",
      "name": "referral_required",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_transferrin_sat_bool",
      "name": "transferrin_sat",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_raised_igm_bool",
      "name": "raised_igm",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_raised_igg_bool",
      "name": "raised_igg",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_ulcerative_colitis_or_panca_bool",
      "name": "ulcerative_colitis_or_panca",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    }
  ]
}