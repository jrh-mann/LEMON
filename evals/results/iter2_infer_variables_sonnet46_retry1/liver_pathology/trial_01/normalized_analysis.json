{
  "inputs": [],
  "outputs": [
    {
      "name": "Mark as Normal / Satisfactory",
      "description": "Tests have normalised or notably improved; mark as normal/satisfactory"
    },
    {
      "name": "No Concern, or escalation required",
      "description": "No concern or escalation required; case closed"
    },
    {
      "name": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
      "description": "Refer patient to secondary care"
    }
  ],
  "tree": {
    "start": {
      "id": "start",
      "type": "start",
      "label": "Liver Pathology Suspected & Work up Initiated",
      "children": [
        {
          "id": "n_phase1_action",
          "type": "action",
          "label": "Phase 1: Send Acuflix Template & request alcohol info",
          "input_ids": [],
          "edge_label": "",
          "children": [
            {
              "id": "n_phase2_bloods",
              "type": "action",
              "label": "Phase 2: Baseline & Phase 2 Bloods: LFT, FBC, AST, GGT (To allow FIB4 Calculation)",
              "input_ids": [],
              "edge_label": "",
              "children": [
                {
                  "id": "n_tests_normalise",
                  "type": "decision",
                  "label": "Tests normalise or notably improve?",
                  "input_ids": [
                    "input_tests_normalise_bool"
                  ],
                  "condition": {
                    "input_id": "input_tests_normalise_bool",
                    "comparator": "is_true"
                  },
                  "edge_label": "",
                  "children": [
                    {
                      "id": "n_mark_normal",
                      "type": "output",
                      "label": "Mark as Normal / Satisfactory",
                      "input_ids": [],
                      "edge_label": "true",
                      "children": []
                    },
                    {
                      "id": "n_alt_abnormal",
                      "type": "decision",
                      "label": "ALT remains abnormal, worsens and/or additional tests are abnormal too",
                      "input_ids": [
                        "input_alt_status_enum"
                      ],
                      "condition": {
                        "input_id": "input_alt_status_enum",
                        "comparator": "enum_eq",
                        "value": "abnormal_or_worsening"
                      },
                      "edge_label": "false",
                      "children": [
                        {
                          "id": "n_findings_duration",
                          "type": "decision",
                          "label": "Findings present for how long?",
                          "input_ids": [
                            "input_findings_duration_enum"
                          ],
                          "condition": {
                            "input_id": "input_findings_duration_enum",
                            "comparator": "enum_eq",
                            "value": "less_than_3_months"
                          },
                          "edge_label": "",
                          "children": [
                            {
                              "id": "n_recheck_baseline",
                              "type": "action",
                              "label": "Recheck Baseline Liver Profile in appropriate timeframe",
                              "input_ids": [],
                              "edge_label": "true",
                              "children": [
                                {
                                  "id": "n_sustained_abnormalities",
                                  "type": "decision",
                                  "label": "Sustained or worsening abnormalities?",
                                  "input_ids": [
                                    "input_abnormalities_sustained_bool"
                                  ],
                                  "condition": {
                                    "input_id": "input_abnormalities_sustained_bool",
                                    "comparator": "is_true"
                                  },
                                  "edge_label": "",
                                  "children": [
                                    {
                                      "id": "n_phase3_fib4",
                                      "type": "action",
                                      "label": "Phase 3: FIB 4 Score & NAFLD Fibrosis Score",
                                      "input_ids": [],
                                      "edge_label": "true",
                                      "children": [
                                        {
                                          "id": "n_consultation",
                                          "type": "action",
                                          "label": "Patient needs consultation for liver pathology and consent for further testing",
                                          "input_ids": [],
                                          "edge_label": "",
                                          "children": [
                                            {
                                              "id": "n_request_liver_uss",
                                              "type": "action",
                                              "label": "Request Liver USS if not done since abnormal LFT have been noted",
                                              "input_ids": [],
                                              "edge_label": "",
                                              "children": [
                                                {
                                                  "id": "n_phase4_bloods_main",
                                                  "type": "action",
                                                  "label": "Phase 4 Bloods",
                                                  "input_ids": [],
                                                  "edge_label": "",
                                                  "children": [
                                                    {
                                                      "id": "n_mandatory_testing",
                                                      "type": "action",
                                                      "label": "Mandatory Testing",
                                                      "input_ids": [],
                                                      "edge_label": "",
                                                      "children": [
                                                        {
                                                          "id": "n_wilsons_screen",
                                                          "type": "action",
                                                          "label": "Wilsons Disease Screen: Ceruloplasmin, Alpha 1 Antitrypsin (A1AT) Screen, A1AT",
                                                          "input_ids": [],
                                                          "edge_label": "",
                                                          "children": [
                                                            {
                                                              "id": "n_review_result",
                                                              "type": "action",
                                                              "label": "Review Result",
                                                              "input_ids": [],
                                                              "edge_label": "",
                                                              "children": [
                                                                {
                                                                  "id": "n_review_outcome",
                                                                  "type": "decision",
                                                                  "label": "Review Result outcome",
                                                                  "input_ids": [
                                                                    "input_review_result_enum"
                                                                  ],
                                                                  "condition": {
                                                                    "input_id": "input_review_result_enum",
                                                                    "comparator": "enum_eq",
                                                                    "value": "abnormal"
                                                                  },
                                                                  "edge_label": "",
                                                                  "children": [
                                                                    {
                                                                      "id": "n_telephone_consultation",
                                                                      "type": "action",
                                                                      "label": "Telephone Consultation",
                                                                      "input_ids": [],
                                                                      "edge_label": "true",
                                                                      "children": [
                                                                        {
                                                                          "id": "n_no_concern",
                                                                          "type": "output",
                                                                          "label": "No Concern, or escalation required",
                                                                          "input_ids": [],
                                                                          "edge_label": "",
                                                                          "children": []
                                                                        }
                                                                      ]
                                                                    },
                                                                    {
                                                                      "id": "n_referral_secondary",
                                                                      "type": "output",
                                                                      "label": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
                                                                      "input_ids": [],
                                                                      "edge_label": "false",
                                                                      "children": []
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "id": "n_conditional_testing",
                                                      "type": "action",
                                                      "label": "Conditional Testing",
                                                      "input_ids": [],
                                                      "edge_label": "",
                                                      "children": [
                                                        {
                                                          "id": "n_transferrin_decision",
                                                          "type": "decision",
                                                          "label": "Transferrin Sat \u226545% Or Raised Ferritin?",
                                                          "input_ids": [
                                                            "input_transferrin_sat_bool"
                                                          ],
                                                          "condition": {
                                                            "input_id": "input_transferrin_sat_bool",
                                                            "comparator": "is_true"
                                                          },
                                                          "edge_label": "",
                                                          "children": [
                                                            {
                                                              "id": "n_haemochromatosis",
                                                              "type": "action",
                                                              "label": "Haemochromatosis Gene Test",
                                                              "input_ids": [],
                                                              "edge_label": "true",
                                                              "children": []
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "id": "n_raised_igm_decision",
                                                          "type": "decision",
                                                          "label": "Raised IgM?",
                                                          "input_ids": [
                                                            "input_raised_igm_bool"
                                                          ],
                                                          "condition": {
                                                            "input_id": "input_raised_igm_bool",
                                                            "comparator": "is_true"
                                                          },
                                                          "edge_label": "",
                                                          "children": [
                                                            {
                                                              "id": "n_primary_biliary",
                                                              "type": "action",
                                                              "label": "Primary Biliary Cirrhosis Screen: AMA",
                                                              "input_ids": [],
                                                              "edge_label": "true",
                                                              "children": []
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "id": "n_uc_panca_decision",
                                                          "type": "decision",
                                                          "label": "Ulcerative Colitis or P-ANCA positive?",
                                                          "input_ids": [
                                                            "input_ulcerative_colitis_or_panca_bool"
                                                          ],
                                                          "condition": {
                                                            "input_id": "input_ulcerative_colitis_or_panca_bool",
                                                            "comparator": "is_true"
                                                          },
                                                          "edge_label": "",
                                                          "children": [
                                                            {
                                                              "id": "n_mrcp",
                                                              "type": "action",
                                                              "label": "Requires MRCP via Gastroenterology",
                                                              "input_ids": [],
                                                              "edge_label": "true",
                                                              "children": []
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "id": "n_raised_igg_decision",
                                                          "type": "decision",
                                                          "label": "Raised IgG?",
                                                          "input_ids": [
                                                            "input_raised_igg_bool"
                                                          ],
                                                          "condition": {
                                                            "input_id": "input_raised_igg_bool",
                                                            "comparator": "is_true"
                                                          },
                                                          "edge_label": "",
                                                          "children": [
                                                            {
                                                              "id": "n_autoimmune_hep",
                                                              "type": "action",
                                                              "label": "Autoimmune Hepatitis Type 1 Screen: ANA, SMA; Autoimmune Hepatitis Type 2 Screen: LKM-1, SLA (not on EMIS)",
                                                              "input_ids": [],
                                                              "edge_label": "true",
                                                              "children": []
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "id": "n_nafld_score_decision",
                                                      "type": "decision",
                                                      "label": "NAFLD Fibrosis Score Category",
                                                      "input_ids": [
                                                        "input_nafld_fibrosis_score_float",
                                                        "input_age_int",
                                                        "input_nafld_category_enum"
                                                      ],
                                                      "condition": {
                                                        "input_id": "input_nafld_category_enum",
                                                        "comparator": "enum_eq",
                                                        "value": "F0-F2"
                                                      },
                                                      "edge_label": "",
                                                      "children": [
                                                        {
                                                          "id": "n_nafld_f0f2",
                                                          "type": "action",
                                                          "label": "F0-F2 (no to moderate fibrosis): manage risk factors and co-morbidities - Annual Screening",
                                                          "input_ids": [],
                                                          "edge_label": "true",
                                                          "children": []
                                                        },
                                                        {
                                                          "id": "n_nafld_indeterminate",
                                                          "type": "decision",
                                                          "label": "NAFLD Indeterminate Score?",
                                                          "input_ids": [
                                                            "input_nafld_category_enum"
                                                          ],
                                                          "condition": {
                                                            "input_id": "input_nafld_category_enum",
                                                            "comparator": "enum_eq",
                                                            "value": "Indeterminate"
                                                          },
                                                          "edge_label": "false",
                                                          "children": [
                                                            {
                                                              "id": "n_indeterminate_score",
                                                              "type": "action",
                                                              "label": "Indeterminate Score",
                                                              "input_ids": [],
                                                              "edge_label": "true",
                                                              "children": []
                                                            },
                                                            {
                                                              "id": "n_nafld_f3f4",
                                                              "type": "action",
                                                              "label": "F3-F4 (Severe fibrosis or Cirrhosis)",
                                                              "input_ids": [],
                                                              "edge_label": "false",
                                                              "children": []
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    {
                                                      "id": "n_fib4_decision",
                                                      "type": "decision",
                                                      "label": "FIB 4 Categories",
                                                      "input_ids": [
                                                        "input_fib4_score_float",
                                                        "input_age_int",
                                                        "input_fib4_category_enum"
                                                      ],
                                                      "condition": {
                                                        "input_id": "input_fib4_category_enum",
                                                        "comparator": "enum_eq",
                                                        "value": "Low Risk"
                                                      },
                                                      "edge_label": "",
                                                      "children": [
                                                        {
                                                          "id": "n_fib4_low",
                                                          "type": "action",
                                                          "label": "Low Risk",
                                                          "input_ids": [],
                                                          "edge_label": "true",
                                                          "children": []
                                                        },
                                                        {
                                                          "id": "n_fib4_intermediate_high",
                                                          "type": "decision",
                                                          "label": "Intermediate or High Risk?",
                                                          "input_ids": [
                                                            "input_fib4_category_enum"
                                                          ],
                                                          "condition": {
                                                            "input_id": "input_fib4_category_enum",
                                                            "comparator": "enum_eq",
                                                            "value": "Intermediate or High Risk"
                                                          },
                                                          "edge_label": "false",
                                                          "children": [
                                                            {
                                                              "id": "n_fibrous_scan",
                                                              "type": "action",
                                                              "label": "Fibrous Scan if available",
                                                              "input_ids": [],
                                                              "edge_label": "true",
                                                              "children": []
                                                            },
                                                            {
                                                              "id": "n_fib4_high",
                                                              "type": "action",
                                                              "label": "High Risk",
                                                              "input_ids": [],
                                                              "edge_label": "false",
                                                              "children": []
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ]
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "id": "n_code_normal",
                                  "type": "action",
                                  "label": "Code as normal USS and file",
                                  "input_ids": [],
                                  "edge_label": "false",
                                  "children": []
                                }
                              ]
                            },
                            {
                              "id": "n_findings_3months",
                              "type": "action",
                              "label": "Phase 3: FIB 4 Score & NAFLD Fibrosis Score (findings present for \u22653 months)",
                              "input_ids": [],
                              "edge_label": "false",
                              "children": []
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  },
  "doubts": [
    "The diagram has many parallel/concurrent branches (mandatory testing, conditional testing, NAFLD score, FIB4 categories) emanating from 'Phase 4 Bloods', but the tree model only allows a single child per action node. These have been linearized which may not fully represent the parallel nature.",
    "The 'Review Result' node receives inputs from multiple conditional testing branches (Haemochromatosis Gene Test, Primary Biliary Cirrhosis Screen, MRCP, Autoimmune Hepatitis screens) but a tree structure cannot represent multiple parents feeding into a single node.",
    "The NAFLD Fibrosis Score thresholds differ by age (<65: -1.455/0.675, \u226565: -2.0/0.675) \u2014 the exact age cutoff logic is complex and partially illegible in the diagram.",
    "The FIB-4 thresholds also differ by age (<65: 1.3/2.67, \u226565: 2.0/2.67) \u2014 partially illegible.",
    "The 'Code as normal USS and file' branch from 'Recheck Baseline Liver Profile' \u2014 it is unclear if this applies when abnormalities are not sustained or when a different condition is met.",
    "The 'Telephone Consultation' node feeds into 'No Concern, or escalation required' but also appears to receive input from Phase 4 results \u2014 the exact branching logic after telephone consultation is ambiguous.",
    "The 'Phase 4 Bloods' box in the lower right appears to be a second instance of Phase 4 Bloods reached from FIB4/NAFLD high-risk categories \u2014 it's unclear if this is a loop back or a separate node.",
    "The 'Refer to Secondary Care' node is reached both from F3-F4 (NAFLD) and High Risk (FIB4) paths, and also after review \u2014 these merge points cannot be cleanly represented in a strict tree.",
    "Some text in the diagram (especially score thresholds) is too small to read with full confidence."
  ],
  "variables": [
    {
      "id": "input_tests_normalise_bool",
      "name": "tests_normalise",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_alt_status_enum",
      "name": "alt_status",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_findings_duration_enum",
      "name": "findings_duration",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_abnormalities_sustained_bool",
      "name": "abnormalities_sustained",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_review_result_enum",
      "name": "review_result",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_transferrin_sat_bool",
      "name": "transferrin_sat",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_raised_igm_bool",
      "name": "raised_igm",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_ulcerative_colitis_or_panca_bool",
      "name": "ulcerative_colitis_or_panca",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_raised_igg_bool",
      "name": "raised_igg",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_nafld_category_enum",
      "name": "nafld_category",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_nafld_fibrosis_score_float",
      "name": "nafld_fibrosis_score",
      "type": "float",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_age_int",
      "name": "age",
      "type": "int",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_fib4_category_enum",
      "name": "fib4_category",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_fib4_score_float",
      "name": "fib4_score",
      "type": "float",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    }
  ]
}