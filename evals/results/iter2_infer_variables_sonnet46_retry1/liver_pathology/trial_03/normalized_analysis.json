{
  "inputs": [],
  "outputs": [
    {
      "name": "Mark as Normal / Satisfactory",
      "description": "Tests have normalised or notably improved; mark as normal/satisfactory"
    },
    {
      "name": "Code as normal USS and file",
      "description": "Findings present for <3 months and FIB4/NAFLD normal; code as normal USS and file"
    },
    {
      "name": "No Concern, or escalation required",
      "description": "No further concern or escalation required"
    },
    {
      "name": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
      "description": "Patient referred to secondary care"
    },
    {
      "name": "Requires MRCP via Gastroenterology",
      "description": "Ulcerative Colitis or P-ANCA positive; requires MRCP via Gastroenterology"
    },
    {
      "name": "manage risk factors and co-morbidities - Annual Screening",
      "description": "NAFLD F0-F2 and FIB-4 Low Risk; manage risk factors and co-morbidities with annual screening"
    }
  ],
  "tree": {
    "start": {
      "id": "start",
      "type": "start",
      "label": "Liver Pathology Suspected & Work up Initiated",
      "children": [
        {
          "id": "n_phase1",
          "type": "action",
          "label": "Phase 1\nBaseline & Phase 2 Bloods: LFT, FBC, AST, GGT (To allow FIB4 Calculation)",
          "input_ids": [],
          "edge_label": "",
          "children": [
            {
              "id": "n_tests_normalise",
              "type": "decision",
              "label": "Tests normalise or notably improve",
              "input_ids": [
                "input_tests_normalise_bool"
              ],
              "condition": {
                "input_id": "input_tests_normalise_bool",
                "comparator": "is_true"
              },
              "children": [
                {
                  "id": "n_mark_normal",
                  "type": "output",
                  "label": "Mark as Normal / Satisfactory",
                  "edge_label": "true",
                  "children": []
                },
                {
                  "id": "n_recheck",
                  "type": "action",
                  "label": "Recheck Baseline Liver Profile in appropriate timeframe\nThe repeat test should meet 3 month criteria (from when concern was first identified)",
                  "edge_label": "false",
                  "children": [
                    {
                      "id": "n_alt_abnormal",
                      "type": "decision",
                      "label": "ALT remains abnormal, worsens and/or additional tests are abnormal too",
                      "input_ids": [
                        "input_alt_status_enum"
                      ],
                      "condition": {
                        "input_id": "input_alt_status_enum",
                        "comparator": "enum_eq",
                        "value": "abnormal_or_worsened"
                      },
                      "children": [
                        {
                          "id": "n_findings_duration",
                          "type": "decision",
                          "label": "findings present for <3 months or >=3 months?",
                          "input_ids": [
                            "input_findings_duration_enum"
                          ],
                          "condition": {
                            "input_id": "input_findings_duration_enum",
                            "comparator": "enum_eq",
                            "value": "less_than_3_months"
                          },
                          "edge_label": "true",
                          "children": [
                            {
                              "id": "n_code_normal",
                              "type": "output",
                              "label": "Code as normal USS and file",
                              "edge_label": "true",
                              "children": []
                            },
                            {
                              "id": "n_phase3",
                              "type": "action",
                              "label": "Phase 3\nFIB 4 Score & NAFLD Fibrosis Score",
                              "edge_label": "false",
                              "children": [
                                {
                                  "id": "n_patient_consultation",
                                  "type": "action",
                                  "label": "Patient needs consultation for liver pathology and consent for further testing",
                                  "children": [
                                    {
                                      "id": "n_sustained_worsening",
                                      "type": "decision",
                                      "label": "Sustained or worsening abnormalities",
                                      "input_ids": [
                                        "input_alt_status_enum"
                                      ],
                                      "condition": {
                                        "input_id": "input_alt_status_enum",
                                        "comparator": "enum_eq",
                                        "value": "sustained_or_worsening"
                                      },
                                      "children": [
                                        {
                                          "id": "n_request_uss",
                                          "type": "action",
                                          "label": "Request Liver USS if not done since abnormal LFT have been noted",
                                          "edge_label": "true",
                                          "children": [
                                            {
                                              "id": "n_mandatory_testing",
                                              "type": "action",
                                              "label": "Mandatory Testing",
                                              "children": [
                                                {
                                                  "id": "n_wilsons",
                                                  "type": "action",
                                                  "label": "Wilsons Disease Screen:\n\u2022 Ceruloplasmin\nAlpha 1 Antitrypsin (A1AT) Screen\n\u2022 A1AT",
                                                  "children": [
                                                    {
                                                      "id": "n_transferrin_decision",
                                                      "type": "decision",
                                                      "label": "Transferrin Sat >45% Or Raised Ferritin",
                                                      "input_ids": [
                                                        "input_transferrin_sat_raised_bool"
                                                      ],
                                                      "condition": {
                                                        "input_id": "input_transferrin_sat_raised_bool",
                                                        "comparator": "is_true"
                                                      },
                                                      "children": [
                                                        {
                                                          "id": "n_haemochromatosis",
                                                          "type": "action",
                                                          "label": "Haemochromatosis Gene Test",
                                                          "edge_label": "true",
                                                          "children": [
                                                            {
                                                              "id": "n_raised_igm_decision",
                                                              "type": "decision",
                                                              "label": "Raised IgM",
                                                              "input_ids": [
                                                                "input_raised_igm_bool"
                                                              ],
                                                              "condition": {
                                                                "input_id": "input_raised_igm_bool",
                                                                "comparator": "is_true"
                                                              },
                                                              "children": [
                                                                {
                                                                  "id": "n_primary_biliary",
                                                                  "type": "action",
                                                                  "label": "Primary Biliary Cirrhosis Screen\n\u2022 AMA",
                                                                  "edge_label": "true",
                                                                  "children": [
                                                                    {
                                                                      "id": "n_review_result",
                                                                      "type": "action",
                                                                      "label": "Review Result",
                                                                      "children": [
                                                                        {
                                                                          "id": "n_result_abnormal",
                                                                          "type": "decision",
                                                                          "label": "Result abnormal?",
                                                                          "input_ids": [
                                                                            "input_result_abnormal_bool"
                                                                          ],
                                                                          "condition": {
                                                                            "input_id": "input_result_abnormal_bool",
                                                                            "comparator": "is_true"
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "id": "n_telephone_consultation",
                                                                              "type": "action",
                                                                              "label": "Telephone Consultation",
                                                                              "edge_label": "true",
                                                                              "children": [
                                                                                {
                                                                                  "id": "n_referral_required",
                                                                                  "type": "decision",
                                                                                  "label": "Referral required to secondary care",
                                                                                  "input_ids": [
                                                                                    "input_referral_required_bool"
                                                                                  ],
                                                                                  "condition": {
                                                                                    "input_id": "input_referral_required_bool",
                                                                                    "comparator": "is_true"
                                                                                  },
                                                                                  "children": [
                                                                                    {
                                                                                      "id": "n_no_concern",
                                                                                      "type": "output",
                                                                                      "label": "No Concern, or escalation required",
                                                                                      "edge_label": "false",
                                                                                      "children": []
                                                                                    },
                                                                                    {
                                                                                      "id": "n_refer_secondary",
                                                                                      "type": "output",
                                                                                      "label": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
                                                                                      "edge_label": "true",
                                                                                      "children": []
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              ]
                                                                            },
                                                                            {
                                                                              "id": "n_no_concern2",
                                                                              "type": "output",
                                                                              "label": "No Concern, or escalation required",
                                                                              "edge_label": "false",
                                                                              "children": []
                                                                            }
                                                                          ]
                                                                        }
                                                                      ]
                                                                    }
                                                                  ]
                                                                },
                                                                {
                                                                  "id": "n_raised_igg_decision",
                                                                  "type": "decision",
                                                                  "label": "Raised IgG (>0.675)",
                                                                  "input_ids": [
                                                                    "input_raised_igg_bool"
                                                                  ],
                                                                  "condition": {
                                                                    "input_id": "input_raised_igg_bool",
                                                                    "comparator": "is_true"
                                                                  },
                                                                  "edge_label": "false",
                                                                  "children": [
                                                                    {
                                                                      "id": "n_autoimmune",
                                                                      "type": "action",
                                                                      "label": "Autoimmune Hepatitis Type 1 Screen\n\u2022 ANA\n\u2022 SMA\nAutoimmune Hepatitis Type 2 Screen\n\u2022 LKM-1\n\u2022 SLA (not on EMIS)",
                                                                      "edge_label": "true",
                                                                      "children": [
                                                                        {
                                                                          "id": "n_review_result2",
                                                                          "type": "action",
                                                                          "label": "Review Result",
                                                                          "children": [
                                                                            {
                                                                              "id": "n_result_abnormal2",
                                                                              "type": "decision",
                                                                              "label": "Result abnormal?",
                                                                              "input_ids": [
                                                                                "input_result_abnormal_bool"
                                                                              ],
                                                                              "condition": {
                                                                                "input_id": "input_result_abnormal_bool",
                                                                                "comparator": "is_true"
                                                                              },
                                                                              "children": [
                                                                                {
                                                                                  "id": "n_telephone_consultation2",
                                                                                  "type": "action",
                                                                                  "label": "Telephone Consultation",
                                                                                  "edge_label": "true",
                                                                                  "children": [
                                                                                    {
                                                                                      "id": "n_referral_required2",
                                                                                      "type": "decision",
                                                                                      "label": "Referral required to secondary care",
                                                                                      "input_ids": [
                                                                                        "input_referral_required_bool"
                                                                                      ],
                                                                                      "condition": {
                                                                                        "input_id": "input_referral_required_bool",
                                                                                        "comparator": "is_true"
                                                                                      },
                                                                                      "children": [
                                                                                        {
                                                                                          "id": "n_no_concern3",
                                                                                          "type": "output",
                                                                                          "label": "No Concern, or escalation required",
                                                                                          "edge_label": "false",
                                                                                          "children": []
                                                                                        },
                                                                                        {
                                                                                          "id": "n_refer_secondary2",
                                                                                          "type": "output",
                                                                                          "label": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
                                                                                          "edge_label": "true",
                                                                                          "children": []
                                                                                        }
                                                                                      ]
                                                                                    }
                                                                                  ]
                                                                                },
                                                                                {
                                                                                  "id": "n_no_concern4",
                                                                                  "type": "output",
                                                                                  "label": "No Concern, or escalation required",
                                                                                  "edge_label": "false",
                                                                                  "children": []
                                                                                }
                                                                              ]
                                                                            }
                                                                          ]
                                                                        }
                                                                      ]
                                                                    },
                                                                    {
                                                                      "id": "n_review_result3",
                                                                      "type": "action",
                                                                      "label": "Review Result",
                                                                      "edge_label": "false",
                                                                      "children": [
                                                                        {
                                                                          "id": "n_result_abnormal3",
                                                                          "type": "decision",
                                                                          "label": "Result abnormal?",
                                                                          "input_ids": [
                                                                            "input_result_abnormal_bool"
                                                                          ],
                                                                          "condition": {
                                                                            "input_id": "input_result_abnormal_bool",
                                                                            "comparator": "is_true"
                                                                          },
                                                                          "children": [
                                                                            {
                                                                              "id": "n_telephone_consultation3",
                                                                              "type": "action",
                                                                              "label": "Telephone Consultation",
                                                                              "edge_label": "true",
                                                                              "children": [
                                                                                {
                                                                                  "id": "n_referral_required3",
                                                                                  "type": "decision",
                                                                                  "label": "Referral required to secondary care",
                                                                                  "input_ids": [
                                                                                    "input_referral_required_bool"
                                                                                  ],
                                                                                  "condition": {
                                                                                    "input_id": "input_referral_required_bool",
                                                                                    "comparator": "is_true"
                                                                                  },
                                                                                  "children": [
                                                                                    {
                                                                                      "id": "n_no_concern5",
                                                                                      "type": "output",
                                                                                      "label": "No Concern, or escalation required",
                                                                                      "edge_label": "false",
                                                                                      "children": []
                                                                                    },
                                                                                    {
                                                                                      "id": "n_refer_secondary3",
                                                                                      "type": "output",
                                                                                      "label": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
                                                                                      "edge_label": "true",
                                                                                      "children": []
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              ]
                                                                            },
                                                                            {
                                                                              "id": "n_no_concern6",
                                                                              "type": "output",
                                                                              "label": "No Concern, or escalation required",
                                                                              "edge_label": "false",
                                                                              "children": []
                                                                            }
                                                                          ]
                                                                        }
                                                                      ]
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          ]
                                                        },
                                                        {
                                                          "id": "n_skip_haemo",
                                                          "type": "action",
                                                          "label": "Phase 4 Bloods (Conditional Testing branch)",
                                                          "edge_label": "false",
                                                          "children": [
                                                            {
                                                              "id": "n_panca_decision",
                                                              "type": "decision",
                                                              "label": "Ulcerative Colitis or P-ANCA positive",
                                                              "input_ids": [
                                                                "input_ulcerative_colitis_or_panca_bool"
                                                              ],
                                                              "condition": {
                                                                "input_id": "input_ulcerative_colitis_or_panca_bool",
                                                                "comparator": "is_true"
                                                              },
                                                              "children": [
                                                                {
                                                                  "id": "n_mrcp",
                                                                  "type": "output",
                                                                  "label": "Requires MRCP via Gastroenterology",
                                                                  "edge_label": "true",
                                                                  "children": []
                                                                },
                                                                {
                                                                  "id": "n_phase4_main",
                                                                  "type": "action",
                                                                  "label": "Phase 4 Bloods",
                                                                  "edge_label": "false",
                                                                  "children": [
                                                                    {
                                                                      "id": "n_nafld_decision",
                                                                      "type": "decision",
                                                                      "label": "NAFLD Fibrosis Score Categories",
                                                                      "input_ids": [
                                                                        "input_nafld_fibrosis_score_enum"
                                                                      ],
                                                                      "condition": {
                                                                        "input_id": "input_nafld_fibrosis_score_enum",
                                                                        "comparator": "enum_eq",
                                                                        "value": "f0_f2"
                                                                      },
                                                                      "children": [
                                                                        {
                                                                          "id": "n_fib4_decision",
                                                                          "type": "decision",
                                                                          "label": "FIB 4 Categories",
                                                                          "input_ids": [
                                                                            "input_fib4_score_enum"
                                                                          ],
                                                                          "condition": {
                                                                            "input_id": "input_fib4_score_enum",
                                                                            "comparator": "enum_eq",
                                                                            "value": "low_risk"
                                                                          },
                                                                          "edge_label": "true",
                                                                          "children": [
                                                                            {
                                                                              "id": "n_manage_risk",
                                                                              "type": "output",
                                                                              "label": "manage risk factors and co-morbidities - Annual Screening",
                                                                              "edge_label": "true",
                                                                              "children": []
                                                                            },
                                                                            {
                                                                              "id": "n_fibrous_scan",
                                                                              "type": "action",
                                                                              "label": "Fibrous Scan if available",
                                                                              "edge_label": "false",
                                                                              "children": [
                                                                                {
                                                                                  "id": "n_fib4_high",
                                                                                  "type": "decision",
                                                                                  "label": "FIB-4 High Risk (>2.67 at any age)",
                                                                                  "input_ids": [
                                                                                    "input_fib4_score_enum"
                                                                                  ],
                                                                                  "condition": {
                                                                                    "input_id": "input_fib4_score_enum",
                                                                                    "comparator": "enum_eq",
                                                                                    "value": "high_risk"
                                                                                  },
                                                                                  "children": [
                                                                                    {
                                                                                      "id": "n_phase4_bloods2",
                                                                                      "type": "action",
                                                                                      "label": "Phase 4 Bloods",
                                                                                      "edge_label": "true",
                                                                                      "children": [
                                                                                        {
                                                                                          "id": "n_refer_secondary4",
                                                                                          "type": "output",
                                                                                          "label": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
                                                                                          "edge_label": "",
                                                                                          "children": []
                                                                                        }
                                                                                      ]
                                                                                    },
                                                                                    {
                                                                                      "id": "n_intermediate_risk",
                                                                                      "type": "action",
                                                                                      "label": "Intermediate or High Risk",
                                                                                      "edge_label": "false",
                                                                                      "children": [
                                                                                        {
                                                                                          "id": "n_phase4_bloods3",
                                                                                          "type": "action",
                                                                                          "label": "Phase 4 Bloods",
                                                                                          "children": [
                                                                                            {
                                                                                              "id": "n_refer_secondary5",
                                                                                              "type": "output",
                                                                                              "label": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
                                                                                              "edge_label": "",
                                                                                              "children": []
                                                                                            }
                                                                                          ]
                                                                                        }
                                                                                      ]
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              ]
                                                                            }
                                                                          ]
                                                                        },
                                                                        {
                                                                          "id": "n_nafld_indeterminate",
                                                                          "type": "decision",
                                                                          "label": "Indeterminate Score (-1.455 to 0.675)",
                                                                          "input_ids": [
                                                                            "input_nafld_fibrosis_score_enum"
                                                                          ],
                                                                          "condition": {
                                                                            "input_id": "input_nafld_fibrosis_score_enum",
                                                                            "comparator": "enum_eq",
                                                                            "value": "indeterminate"
                                                                          },
                                                                          "edge_label": "false",
                                                                          "children": [
                                                                            {
                                                                              "id": "n_indeterminate_action",
                                                                              "type": "action",
                                                                              "label": "Indeterminate Score",
                                                                              "edge_label": "true",
                                                                              "children": [
                                                                                {
                                                                                  "id": "n_fibrous_scan2",
                                                                                  "type": "action",
                                                                                  "label": "Fibrous Scan if available",
                                                                                  "children": [
                                                                                    {
                                                                                      "id": "n_phase4_bloods4",
                                                                                      "type": "action",
                                                                                      "label": "Phase 4 Bloods",
                                                                                      "children": [
                                                                                        {
                                                                                          "id": "n_refer_secondary6",
                                                                                          "type": "output",
                                                                                          "label": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
                                                                                          "edge_label": "",
                                                                                          "children": []
                                                                                        }
                                                                                      ]
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              ]
                                                                            },
                                                                            {
                                                                              "id": "n_f3f4",
                                                                              "type": "action",
                                                                              "label": "F3-F4 (Severe fibrosis or Cirrhosis) >0.675",
                                                                              "edge_label": "false",
                                                                              "children": [
                                                                                {
                                                                                  "id": "n_phase4_bloods5",
                                                                                  "type": "action",
                                                                                  "label": "Phase 4 Bloods",
                                                                                  "children": [
                                                                                    {
                                                                                      "id": "n_refer_secondary7",
                                                                                      "type": "output",
                                                                                      "label": "Refer to Secondary Care once bloods are back, irrespective of diagnosis or if all tests normal",
                                                                                      "edge_label": "",
                                                                                      "children": []
                                                                                    }
                                                                                  ]
                                                                                }
                                                                              ]
                                                                            }
                                                                          ]
                                                                        }
                                                                      ]
                                                                    }
                                                                  ]
                                                                }
                                                              ]
                                                            }
                                                          ]
                                                        }
                                                      ]
                                                    }
                                                  ]
                                                }
                                              ]
                                            }
                                          ]
                                        },
                                        {
                                          "id": "n_not_sustained",
                                          "type": "output",
                                          "label": "No Concern, or escalation required",
                                          "edge_label": "false",
                                          "children": []
                                        }
                                      ]
                                    }
                                  ]
                                }
                              ]
                            }
                          ]
                        }
                      ]
                    }
                  ]
                }
              ]
            }
          ]
        }
      ]
    }
  },
  "doubts": [
    "The diagram has many converging arrows and feedback loops (e.g., Review Result feeds back into Telephone Consultation and then No Concern or referral) which are difficult to represent as a strict tree without duplicating nodes.",
    "The 'Phase 4 Bloods' node appears multiple times in the diagram with arrows converging from different branches (NAFLD score, FIB-4 score, rare conditions); it is unclear if this is a single shared node or separate instances.",
    "The 'Telephone Consultation' node appears to receive inputs from multiple branches (Review Result abnormal, and directly from the rare conditions branch); exact branching logic is ambiguous.",
    "The 'Need to rationalise which Additional tests should be done for rare conditions' branch and its relationship to Mandatory Testing vs Conditional Testing is not fully clear from the diagram resolution.",
    "FIB-4 thresholds differ by age (1.3 general, 2.0 for age 65+, 2.67 high risk); age input is not explicitly shown as a separate input node in the diagram.",
    "The 'Conditional Testing' node and its relationship to Ulcerative Colitis/P-ANCA and Raised IgG branches is ambiguous - it is unclear if these are sequential checks or parallel.",
    "Several arrows in the diagram cross or converge in ways that suggest a directed acyclic graph rather than a tree; the tree representation here necessarily duplicates some terminal nodes."
  ],
  "variables": [
    {
      "id": "input_tests_normalise_bool",
      "name": "tests_normalise",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_alt_status_enum",
      "name": "alt_status",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_findings_duration_enum",
      "name": "findings_duration",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_transferrin_sat_raised_bool",
      "name": "transferrin_sat_raised",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_raised_igm_bool",
      "name": "raised_igm",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_result_abnormal_bool",
      "name": "result_abnormal",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_referral_required_bool",
      "name": "referral_required",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_raised_igg_bool",
      "name": "raised_igg",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_ulcerative_colitis_or_panca_bool",
      "name": "ulcerative_colitis_or_panca",
      "type": "bool",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_nafld_fibrosis_score_enum",
      "name": "nafld_fibrosis_score",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    },
    {
      "id": "input_fib4_score_enum",
      "name": "fib4_score",
      "type": "enum",
      "description": "Inferred from workflow conditions.",
      "source": "inferred"
    }
  ]
}